:root {
  --bg: #12161f;
  --panel: #1b2230;
  --panel-2: #242d40;
  --text: #e8eefc;
  --muted: #a3b0cc;
  --accent: #77b6ff;
}
* { box-sizing: border-box; }
html, body { margin: 0; background: var(--bg); color: var(--text); font-family: Inter, system-ui, sans-serif; height: 100%; }
body { overflow: hidden; }
.app { height: 100vh; display: flex; flex-direction: column; gap: 10px; padding: 12px; }
.top-bar { display: flex; justify-content: space-between; align-items: center; }
.top-actions { display: flex; gap: 10px; align-items: center; }
.turn-indicator { padding: 8px 10px; border-radius: 8px; border: 1px solid #425170; background: #161f2f; font-weight: 600; }
.board-stage { flex: 1; min-height: 0; display: grid; place-items: center; }
.board { width: min(100%, calc((100vh - 320px) * (var(--cols) / var(--rows)))); aspect-ratio: var(--cols) / var(--rows); display: grid; grid-template-columns: repeat(var(--cols), minmax(0, 1fr)); grid-template-rows: repeat(var(--rows), minmax(0, 1fr)); border: 2px solid #0a0e17; border-radius: 10px; overflow: hidden; }
.tile { position: relative; border: 1px solid rgba(0,0,0,.16); cursor: pointer; }
.tile.ground { background: #4f9965; }
.tile.wall { background: #79553d; }
.tile.blank { background: #6f7380; }
.enemy, .trap { position: absolute; inset: 0; display: grid; place-items: center; pointer-events: none; }
.enemy { font-size: clamp(12px, 1.3vw, 22px); }
.trap { font-size: clamp(10px, 1.1vw, 18px); opacity: .82; z-index: 1; }
.trap.active-turn { filter: drop-shadow(0 0 5px #ffcc66); opacity: 1; }
.player { position: absolute; inset: 10%; z-index: 3; border-radius: 8px; background: radial-gradient(circle at 30% 30%, #fff, #d9e7ff 48%, #91a7cf 100%); border: 2px solid #222; display: grid; place-items: center; font-weight: 800; color: #111a33; }
.preview { display: grid; grid-template-columns: repeat(auto-fit,minmax(120px,1fr)); gap: 8px; }
.preview-item { background: var(--panel-2); border-radius: 8px; padding: 8px; text-align: center; }
.preview-item strong { display:block; color: var(--muted); font-size: .75rem; }
.section { border: 1px solid #3a4660; border-radius: 10px; padding: 12px; background: var(--panel); }
.log-panel { max-height: 180px; display: flex; flex-direction: column; }
.log-head { display: flex; justify-content: space-between; align-items: center; }
.log-head h3 { margin: 0; }
.event-log { overflow: auto; font-size: .86rem; display: grid; gap: 6px; margin-top: 8px; }
.log-item { padding: 4px 8px; background: #111827; border-radius: 6px; }
button, input, select, textarea { font: inherit; }
button, .button-like { border: none; border-radius: 8px; padding: 8px 12px; color: white; background: #3d5fa8; cursor: pointer; }
button.secondary, .button-like.secondary { background: #47526b; }
button.danger { background: #9c2f43; }
.modal { position: fixed; inset: 0; background: rgba(6,8,12,.72); display: none; align-items: center; justify-content: center; padding: 16px; z-index: 20; }
.modal.open { display: flex; }
.modal-panel { width: min(1100px,100%); max-height: 92vh; overflow: auto; border-radius: 12px; background: var(--panel); border: 1px solid #37445f; padding: 14px; display: grid; gap: 12px; }
.enemy-head { display: flex; justify-content: space-between; align-items: center; }
.enemy-head h2 { margin: 0; }
.row { display: grid; grid-template-columns: repeat(auto-fit,minmax(120px,1fr)); gap: 8px; }
.field { display: grid; gap: 6px; }
.field label { font-size: .78rem; color: var(--muted); }
.field input, .field select, .field textarea { border: 1px solid #516180; border-radius: 6px; background: #0f1522; color: var(--text); padding: 7px; }
.stack { display: grid; gap: 8px; }
.enemy-card, .trap-card, .rule-card { border: 1px solid #48597a; border-radius: 10px; padding: 10px; background: #161d2b; display: grid; gap: 8px; }
.toolbar-row { display: flex; gap: 8px; flex-wrap: wrap; }
.info-wrap { position: relative; display: inline-flex; align-items: center; gap: 6px; }
.info-btn { width: 22px; height: 22px; border-radius: 50%; padding: 0; font-weight: 700; }
.info-pop { position: absolute; right: 0; top: 28px; width: min(440px, 85vw); background: #0f1626; border: 1px solid #52627f; border-radius: 8px; padding: 10px; font-size: .8rem; display: none; z-index: 4; }
.info-wrap:hover .info-pop, .info-wrap.open .info-pop { display: block; }
.toast { position: fixed; right: 12px; bottom: 12px; background: #1f7a45; color: #fff; border-radius: 8px; padding: 8px 12px; opacity: 0; transform: translateY(8px); transition: all .2s; }
.toast.show { opacity:1; transform: translateY(0); }
.toast.error { background: #a33344; }
